<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Craps Simulator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .game-container {
            background-color: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .bankroll {
            font-size: 24px;
            color: #2ecc71;
        }
        .dice-display {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            color: #ecf0f1;
        }
        .dice-sum {
            font-size: 72px;
            text-align: center;
            margin: 10px 0;
            color: #e74c3c;
            font-weight: bold;
        }
        .message {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            color: #ecf0f1;
        }
        .point-display {
            text-align: center;
            font-size: 20px;
            color: #bdc3c7;
            margin: 10px 0;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        button {
            padding: 12px 24px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #rollButton {
            background-color: #3498db;
            color: white;
        }
        #rollButton:hover {
            background-color: #2980b9;
        }
        #resetButton {
            background-color: #e74c3c;
            color: white;
        }
        #resetButton:hover {
            background-color: #c0392b;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .craps-table {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
            background-color: #34495e;
            padding: 20px;
            border-radius: 10px;
        }
        .bet-section {
            background-color: #2c3e50;
            padding: 15px;
            border-radius: 5px;
        }
        .bet-section h3 {
            margin: 0 0 10px 0;
            color: #ecf0f1;
        }
        .bet-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .bet-amount {
            width: 80px;
            padding: 5px;
            border: none;
            border-radius: 3px;
            background-color: #ecf0f1;
        }
        .bet-button {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
        }
        .bet-button:hover {
            background-color: #2980b9;
        }
        .active-bets {
            margin-top: 20px;
            padding: 15px;
            background-color: #34495e;
            border-radius: 5px;
        }
        .active-bets h3 {
            margin: 0 0 10px 0;
            color: #ecf0f1;
        }
        .bet-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .bet-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            color: #ecf0f1;
        }
        .bet-item.won {
            color: #2ecc71;
        }
        .bet-item.lost {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 style="color: #ecf0f1;">Craps Simulator</h1>
            <div class="bankroll">Bankroll: $<span id="bankroll">1000.00</span></div>
        </div>
        <div class="dice-display" id="diceDisplay">ðŸŽ²</div>
        <div class="dice-sum" id="diceSum"></div>
        <div class="message" id="message">Place your bet and roll the dice!</div>
        <div class="point-display" id="pointDisplay"></div>

        <div class="craps-table">
            <div class="bet-section">
                <h3>Pass Line</h3>
                <div class="bet-controls">
                    <input type="number" class="bet-amount" min="5" value="5" step="5">
                    <button class="bet-button" onclick="placeBet('pass')">Bet</button>
                </div>
            </div>
            <div class="bet-section">
                <h3>Don't Pass</h3>
                <div class="bet-controls">
                    <input type="number" class="bet-amount" min="5" value="5" step="5">
                    <button class="bet-button" onclick="placeBet('dont_pass')">Bet</button>
                </div>
            </div>
            <div class="bet-section">
                <h3>Field</h3>
                <div class="bet-controls">
                    <input type="number" class="bet-amount" min="5" value="5" step="5">
                    <button class="bet-button" onclick="placeBet('field')">Bet</button>
                </div>
            </div>
            <div class="bet-section">
                <h3>Any Seven</h3>
                <div class="bet-controls">
                    <input type="number" class="bet-amount" min="5" value="5" step="5">
                    <button class="bet-button" onclick="placeBet('any_seven')">Bet</button>
                </div>
            </div>
            <div class="bet-section">
                <h3>Any Craps</h3>
                <div class="bet-controls">
                    <input type="number" class="bet-amount" min="5" value="5" step="5">
                    <button class="bet-button" onclick="placeBet('any_craps')">Bet</button>
                </div>
            </div>
            <div class="bet-section">
                <h3>Hard Ways</h3>
                <div class="bet-controls">
                    <input type="number" class="bet-amount" min="5" value="5" step="5">
                    <button class="bet-button" onclick="placeBet('hard_4')">Hard 4</button>
                    <button class="bet-button" onclick="placeBet('hard_6')">Hard 6</button>
                    <button class="bet-button" onclick="placeBet('hard_8')">Hard 8</button>
                    <button class="bet-button" onclick="placeBet('hard_10')">Hard 10</button>
                </div>
            </div>
        </div>

        <div class="active-bets">
            <h3>Active Bets</h3>
            <ul class="bet-list" id="activeBets"></ul>
        </div>

        <div class="controls">
            <button id="rollButton" onclick="rollDice()">Roll Dice</button>
            <button id="resetButton" onclick="resetGame()">New Game</button>
        </div>
    </div>

    <script>
        let gameActive = true;
        let activeBets = new Map();

        function updateUI(state) {
            console.log('Updating UI with state:', state);
            
            // Update bankroll
            document.getElementById('bankroll').textContent = state.bankroll.toFixed(2);
            
            // Update dice display
            const diceDisplay = document.getElementById('diceDisplay');
            diceDisplay.textContent = state.lastRoll ? `ðŸŽ²` : 'ðŸŽ²';
            
            // Update dice sum
            const diceSum = document.getElementById('diceSum');
            diceSum.textContent = state.lastRoll ? state.lastRoll : '';
            
            // Update message
            const messageElement = document.getElementById('message');
            messageElement.textContent = state.message;
            
            // Update point display
            const pointDisplay = document.getElementById('pointDisplay');
            pointDisplay.textContent = state.isPointSet ? `Point: ${state.point}` : '';
            
            // Update roll button state
            const rollButton = document.getElementById('rollButton');
            rollButton.disabled = !state.isGameActive;
            
            // Update active bets
            const activeBetsList = document.getElementById('activeBets');
            activeBetsList.innerHTML = '';
            
            // Process new bets
            state.bets.forEach(bet => {
                if (!activeBets.has(bet.type)) {
                    activeBets.set(bet.type, bet);
                }
            });
            
            // Display all active bets
            activeBets.forEach((bet, type) => {
                if (bet.isActive) {
                    const li = document.createElement('li');
                    li.className = 'bet-item';
                    li.textContent = `${type}: $${bet.amount.toFixed(2)}`;
                    activeBetsList.appendChild(li);
                }
            });
            
            // Update game state
            gameActive = state.isGameActive;
            
            // Clear bets if game is not active
            if (!state.isGameActive) {
                activeBets.clear();
            }
        }

        async function placeBet(betType) {
            const amountInput = event.target.parentElement.querySelector('.bet-amount');
            const amount = parseFloat(amountInput.value);
            
            try {
                console.log('Placing bet:', betType, amount);
                const response = await fetch('/bet', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: betType,
                        amount: amount
                    })
                });
                
                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error);
                }
                
                const state = await response.json();
                console.log('Received state:', state);
                updateUI(state);
            } catch (error) {
                console.error('Error placing bet:', error);
                document.getElementById('message').textContent = `Error: ${error.message}`;
            }
        }

        async function rollDice() {
            if (!gameActive) return;
            
            try {
                console.log('Rolling dice...');
                const response = await fetch('/roll', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const state = await response.json();
                console.log('Received state:', state);
                updateUI(state);
            } catch (error) {
                console.error('Error rolling dice:', error);
                document.getElementById('message').textContent = 'Error: Could not roll dice. Please try again.';
            }
        }

        async function resetGame() {
            try {
                console.log('Resetting game...');
                const response = await fetch('/reset', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const state = await response.json();
                console.log('Received reset state:', state);
                activeBets.clear();
                updateUI(state);
            } catch (error) {
                console.error('Error resetting game:', error);
                document.getElementById('message').textContent = 'Error: Could not reset game. Please try again.';
            }
        }

        // Initial state load
        async function loadInitialState() {
            try {
                console.log('Loading initial state...');
                const response = await fetch('/state', {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const state = await response.json();
                console.log('Received initial state:', state);
                updateUI(state);
            } catch (error) {
                console.error('Error loading initial state:', error);
                document.getElementById('message').textContent = 'Error: Could not load game state. Please refresh the page.';
            }
        }

        // Load initial state when page loads
        loadInitialState();
    </script>
</body>
</html> 